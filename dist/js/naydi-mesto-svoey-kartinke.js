const{speakSequence,speak,shuffle,setFeedback,updateProgress,wait,initSpeechWarmup}=window.GameUtils,optionLeft=document.getElementById("option-left"),optionRight=document.getElementById("option-right"),optionLeftText=document.getElementById("option-left-text"),optionRightText=document.getElementById("option-right-text"),bottomCard=document.getElementById("bottom-card"),bottomWord=document.getElementById("bottom-word"),playButton=document.getElementById("play-all"),feedback=document.getElementById("feedback"),progress=document.getElementById("progress");initSpeechWarmup();const emojiMap={\u043B\u0430\u043A:"\u{1F3A8}",\u0441\u043E\u043A:"\u{1F964}",\u0440\u0430\u043A:"\u{1F99E}",\u043C\u044B\u0448\u043A\u0430:"\u{1F42D}",\u043A\u043E\u0448\u043A\u0430:"\u{1F431}",\u043C\u0438\u0448\u043A\u0430:"\u{1F9F8}",\u0434\u043E\u043C:"\u{1F3E0}",\u043C\u0430\u043A:"\u{1F33A}",\u0441\u043E\u043C:"\u{1F41F}",\u0434\u0443\u043B\u043A\u0430:"\u{1F9C1}",\u0432\u0430\u0433\u043E\u043D:"\u{1F683}",\u0443\u0442\u043A\u0430:"\u{1F986}",\u0431\u0430\u043D\u0442\u0438\u043A:"\u{1F380}",\u0431\u0438\u043D\u043A:"\u{1F524}",\u0444\u0430\u043D\u0442\u0438\u043A:"\u{1F36C}"},baseRounds=[{options:["\u043B\u0430\u043A","\u0441\u043E\u043A"],target:"\u0440\u0430\u043A",similar:"\u043B\u0430\u043A"},{options:["\u043C\u044B\u0448\u043A\u0430","\u043A\u043E\u0448\u043A\u0430"],target:"\u043C\u0438\u0448\u043A\u0430",similar:"\u043C\u044B\u0448\u043A\u0430"},{options:["\u0434\u043E\u043C","\u043C\u0430\u043A"],target:"\u0441\u043E\u043C",similar:"\u0434\u043E\u043C"},{options:["\u0434\u0443\u043B\u043A\u0430","\u0432\u0430\u0433\u043E\u043D"],target:"\u0443\u0442\u043A\u0430",similar:"\u0434\u0443\u043B\u043A\u0430"},{options:["\u0431\u0430\u043D\u0442\u0438\u043A","\u0431\u0438\u043D\u043A"],target:"\u0444\u0430\u043D\u0442\u0438\u043A",similar:"\u0431\u0430\u043D\u0442\u0438\u043A"}],rounds=shuffle(baseRounds.slice()).map(t=>{const e=shuffle(t.options.slice());return{options:e,target:t.target,similar:t.similar,correctIndex:e.indexOf(t.similar)}});let currentIndex=0,score=0,finished=!1;function showRound(){if(currentIndex>=rounds.length){finishGame();return}const t=rounds[currentIndex];optionLeftText.textContent=capitalize(t.options[0]),optionRightText.textContent=capitalize(t.options[1]),optionLeft.querySelector(".emoji").textContent=emojiMap[t.options[0]]||"\u{1F524}",optionRight.querySelector(".emoji").textContent=emojiMap[t.options[1]]||"\u{1F524}",bottomWord.textContent=capitalize(t.target),bottomCard.querySelector(".emoji").textContent=emojiMap[t.target]||"\u{1F3AF}",updateProgress(progress,currentIndex+1,rounds.length),setFeedback(feedback,"\u0421\u043B\u0443\u0448\u0430\u0439\u0442\u0435 \u0438 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0443, \u0437\u0432\u0443\u0447\u0430\u0449\u0443\u044E \u043F\u043E\u0445\u043E\u0436\u0435 \u043D\u0430 \u043D\u0438\u0436\u043D\u0435\u0435 \u0441\u043B\u043E\u0432\u043E.","info"),speakAll()}function capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}function speakAll(){const t=rounds[currentIndex];speakSequence([...t.options,t.target],{speechOptions:{rate:1.05}})}async function handleChoice(t){if(finished)return;const e=rounds[currentIndex];optionLeft.disabled=!0,optionRight.disabled=!0;const n=[optionLeft,optionRight],o=n[t];t===e.correctIndex?(score+=1,o.classList.add("correct"),setFeedback(feedback,"\u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E! \u042D\u0442\u0438 \u0441\u043B\u043E\u0432\u0430 \u0437\u0432\u0443\u0447\u0430\u0442 \u043F\u043E\u0445\u043E\u0436\u0435.","success")):(o.classList.add("wrong"),n[e.correctIndex].classList.add("correct"),setFeedback(feedback,"\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437: \u043D\u0438\u0436\u043D\u0435\u0435 \u0441\u043B\u043E\u0432\u043E \u0437\u0432\u0443\u0447\u0430\u043B\u043E \u0438\u043D\u0430\u0447\u0435.","error")),currentIndex+=1,await wait(1400),n.forEach(s=>{s.classList.remove("correct","wrong"),s.disabled=!1}),showRound()}function finishGame(){finished=!0,setFeedback(feedback,`\u041E\u0442\u043B\u0438\u0447\u043D\u043E! \u0412\u044B \u043F\u043E\u0434\u043E\u0431\u0440\u0430\u043B\u0438 ${score} \u043F\u0430\u0440 \u0438\u0437 ${rounds.length}. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \xAB\u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430\xBB, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C.`,"success"),updateProgress(progress,rounds.length,rounds.length),playButton.textContent="\u{1F501} \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430",optionLeft.disabled=!0,optionRight.disabled=!0}function restartGame(){finished=!1,currentIndex=0,score=0;const t=shuffle(baseRounds.slice()).map(e=>{const n=shuffle(e.options.slice());return{options:n,target:e.target,similar:e.similar,correctIndex:n.indexOf(e.similar)}});rounds.splice(0,rounds.length,...t),playButton.textContent="\u25B6\uFE0F \u041E\u0437\u0432\u0443\u0447\u0438\u0442\u044C \u0432\u0441\u0435 \u0441\u043B\u043E\u0432\u0430",optionLeft.disabled=!1,optionRight.disabled=!1,showRound()}optionLeft.addEventListener("click",()=>handleChoice(0)),optionRight.addEventListener("click",()=>handleChoice(1)),playButton.addEventListener("click",()=>{finished?restartGame():speakAll()}),bottomCard.addEventListener("click",()=>speak(rounds[currentIndex].target,{rate:1.05})),showRound();
