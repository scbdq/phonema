const{speak,shuffle,setFeedback,updateProgress,wait,clearChildren,initSpeechWarmup}=window.GameUtils,grid=document.getElementById("sound-grid"),targetSound=document.getElementById("target-sound"),feedback=document.getElementById("feedback"),progress=document.getElementById("progress");initSpeechWarmup();const rounds=shuffle([{sound:"\u0410",words:[{word:"\u0410\u043D\u044F",hasSound:!0},{word:"\u043A\u043E\u0442",hasSound:!1},{word:"\u0440\u0443\u043A\u0430",hasSound:!0},{word:"\u0431\u044B\u043A",hasSound:!1},{word:"\u0430\u0438\u0441\u0442",hasSound:!0},{word:"\u0449\u0435\u043A\u0430",hasSound:!1}]},{sound:"\u041E",words:[{word:"\u041E\u043B\u044F",hasSound:!0},{word:"\u043C\u0430\u043A",hasSound:!1},{word:"\u043E\u0441\u044B",hasSound:!0},{word:"\u0434\u043D\u043E",hasSound:!0},{word:"\u0443\u0442\u043A\u0430",hasSound:!1},{word:"\u043F\u0435\u0440\u043E",hasSound:!0}]},{sound:"\u0423",words:[{word:"\u0443\u0445\u043E",hasSound:!0},{word:"\u0441\u043E\u043A",hasSound:!1},{word:"\u0443\u043B\u0435\u0439",hasSound:!0},{word:"\u043C\u0430\u043A",hasSound:!1},{word:"\u0443\u0442\u043A\u0430",hasSound:!0},{word:"\u043B\u0443\u043A",hasSound:!0}]},{sound:"\u0422",words:[{word:"\u043A\u043E\u0442",hasSound:!0},{word:"\u0440\u043E\u0442",hasSound:!0},{word:"\u0441\u043E\u043A",hasSound:!1},{word:"\u043A\u0440\u043E\u0442",hasSound:!0},{word:"\u0431\u044B\u043A",hasSound:!1},{word:"\u0434\u043E\u043C",hasSound:!1}]},{sound:"\u041A",words:[{word:"\u043F\u0430\u0443\u043A",hasSound:!0},{word:"\u0441\u0443\u043F",hasSound:!1},{word:"\u043C\u0430\u043A",hasSound:!0},{word:"\u0440\u043E\u0442",hasSound:!1},{word:"\u043A\u043E\u0442",hasSound:!0},{word:"\u0441\u044B\u0440",hasSound:!1}]},{sound:"\u0421",words:[{word:"\u0441\u043E\u043C",hasSound:!0},{word:"\u0434\u043E\u043C",hasSound:!1},{word:"\u043D\u043E\u0441",hasSound:!0},{word:"\u043A\u043E\u0442",hasSound:!1},{word:"\u0441\u044B\u0440",hasSound:!0},{word:"\u043B\u0443\u043A",hasSound:!1}]},{sound:"\u041C",words:[{word:"\u043C\u0430\u043A",hasSound:!0},{word:"\u043B\u0443\u043A",hasSound:!1},{word:"\u0434\u043E\u043C",hasSound:!0},{word:"\u043D\u043E\u0441",hasSound:!1},{word:"\u0441\u043E\u043C",hasSound:!0},{word:"\u0440\u044B\u0431\u0430",hasSound:!1}]}]);let currentIndex=0,score=0,found=0,totalWithSound=0;function showRound(){if(currentIndex>=rounds.length){finishGame();return}const e=rounds[currentIndex];targetSound.textContent=e.sound,updateProgress(progress,currentIndex+1,rounds.length),setFeedback(feedback,"\u041D\u0430\u0436\u0438\u043C\u0430\u0439\u0442\u0435 \u043D\u0430 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0441\u043E \u0441\u043B\u043E\u0432\u0430\u043C\u0438, \u0432 \u043A\u043E\u0442\u043E\u0440\u044B\u0445 \u0441\u043B\u044B\u0448\u0438\u0442\u0441\u044F \u043D\u0443\u0436\u043D\u044B\u0439 \u0437\u0432\u0443\u043A.","info"),clearChildren(grid),found=0,totalWithSound=e.words.filter(d=>d.hasSound).length,shuffle(e.words.slice()).forEach(d=>{const o=document.createElement("button");o.type="button",o.className="word-card",o.dataset.word=d.word,o.dataset.correct=d.hasSound?"true":"false";const s=document.createElement("span");s.className="emoji",s.textContent=d.hasSound?"\u2705":"\u2B50\uFE0F",s.setAttribute("aria-hidden","true"),o.appendChild(s);const t=document.createElement("strong");t.textContent=d.word.charAt(0).toUpperCase()+d.word.slice(1),o.appendChild(t),o.addEventListener("click",()=>handleChoice(o)),grid.appendChild(o)})}async function handleChoice(e){const d=e.dataset.correct==="true",o=e.dataset.word;await speak(o,{rate:1.05}),!e.classList.contains("correct")&&(d?(e.classList.add("correct"),found+=1,setFeedback(feedback,`\u0412\u0435\u0440\u043D\u043E! \u0412 \u0441\u043B\u043E\u0432\u0435 \xAB${o.toUpperCase()}\xBB \u0435\u0441\u0442\u044C \u0437\u0432\u0443\u043A ${rounds[currentIndex].sound}.`,"success"),found>=totalWithSound&&(score+=1,await wait(1200),currentIndex+=1,showRound())):(e.classList.add("wrong"),setFeedback(feedback,`\u0412 \u0441\u043B\u043E\u0432\u0435 \xAB${o.toUpperCase()}\xBB \u043D\u0435\u0442 \u0437\u0432\u0443\u043A\u0430 ${rounds[currentIndex].sound}.`,"error"),setTimeout(()=>{e.classList.remove("wrong")},900)))}function finishGame(){setFeedback(feedback,`\u041E\u0442\u043B\u0438\u0447\u043D\u0430\u044F \u0440\u0430\u0431\u043E\u0442\u0430! \u0412\u044B \u043D\u0430\u0448\u043B\u0438 \u0437\u0432\u0443\u043A \u0432 ${score} \u043D\u0430\u0431\u043E\u0440\u0430\u0445 \u0438\u0437 ${rounds.length}.`,"success"),updateProgress(progress,rounds.length,rounds.length)}showRound();
