const{speakSequence,shuffle,setFeedback,updateProgress,wait,clearChildren,initSpeechWarmup}=window.GameUtils,grid=document.getElementById("syllable-grid"),playButton=document.getElementById("play-row"),feedback=document.getElementById("feedback"),progress=document.getElementById("progress");initSpeechWarmup();const rounds=shuffle([{syllables:["\u043D\u0430","\u043D\u0430","\u043D\u043E"],oddIndex:2},{syllables:["\u043F\u0443","\u043F\u0443","\u043F\u043E"],oddIndex:2},{syllables:["\u0432\u043E","\u0432\u0430","\u0432\u043E"],oddIndex:1},{syllables:["\u0434\u0443","\u0434\u0443","\u0434\u0430"],oddIndex:2},{syllables:["\u043A\u0443","\u043A\u0443","\u043A\u0430"],oddIndex:2},{syllables:["\u043C\u0430","\u043C\u043E","\u043C\u043E"],oddIndex:0},{syllables:["\u0442\u043E","\u0442\u043E","\u0442\u0443"],oddIndex:2},{syllables:["\u0432\u0430","\u0432\u0430","\u0432\u0443"],oddIndex:2}]);let currentIndex=0,score=0,finished=!1;function showRound(){if(currentIndex>=rounds.length){finishGame();return}const t=rounds[currentIndex];clearChildren(grid),t.syllables.forEach((s,d)=>{const e=document.createElement("button");e.type="button",e.className="word-card",e.dataset.index=String(d);const n=document.createElement("span");n.className="emoji",n.textContent="\u{1F916}",n.setAttribute("aria-hidden","true"),e.appendChild(n);const l=document.createElement("strong");l.textContent=s.toUpperCase(),e.appendChild(l),e.addEventListener("click",()=>handleAnswer(e)),grid.appendChild(e)}),updateProgress(progress,currentIndex+1,rounds.length),setFeedback(feedback,"\u041A\u0430\u043A\u043E\u0439 \u0441\u043B\u043E\u0433 \u043F\u0440\u043E\u0438\u0437\u043D\u0435\u0441 \u0440\u043E\u0431\u043E\u0442 \u043D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E?","info"),speakRow()}function speakRow(){const t=rounds[currentIndex];speakSequence(t.syllables,{speechOptions:{rate:1.05},pause:280})}async function handleAnswer(t){if(finished)return;const s=rounds[currentIndex],d=Number(t.dataset.index),e=Array.from(grid.querySelectorAll(".word-card"));e.forEach(n=>n.disabled=!0),d===s.oddIndex?(score+=1,t.classList.add("correct"),setFeedback(feedback,"\u0412\u0435\u0440\u043D\u043E! \u042D\u0442\u043E\u0442 \u0441\u043B\u043E\u0433 \u0437\u0432\u0443\u0447\u0430\u043B \u0438\u043D\u0430\u0447\u0435.","success")):(t.classList.add("wrong"),e[s.oddIndex].classList.add("correct"),setFeedback(feedback,"\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437 \u2014 \u0434\u0440\u0443\u0433\u043E\u0439 \u0441\u043B\u043E\u0433 \u043E\u0442\u043B\u0438\u0447\u0430\u043B\u0441\u044F.","error")),currentIndex+=1,await wait(1300),e.forEach(n=>{n.classList.remove("correct","wrong"),n.disabled=!1}),showRound()}function finishGame(){finished=!0,clearChildren(grid),setFeedback(feedback,`\u041E\u0442\u043B\u0438\u0447\u043D\u043E! \u0412\u044B \u043D\u0430\u0448\u043B\u0438 ${score} \u043E\u0448\u0438\u0431\u043E\u043A \u0438\u0437 ${rounds.length}.`,"success"),updateProgress(progress,rounds.length,rounds.length),playButton.textContent="\u{1F501} \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430"}function restartGame(){finished=!1,currentIndex=0,score=0;const t=shuffle(rounds);rounds.splice(0,rounds.length,...t),playButton.textContent="\u25B6\uFE0F \u041F\u0440\u043E\u0438\u0433\u0440\u0430\u0442\u044C \u0440\u044F\u0434",showRound()}playButton.addEventListener("click",()=>{finished?restartGame():speakRow()}),showRound();
