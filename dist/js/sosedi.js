const{speak,speakSequence,shuffle,setFeedback,updateProgress,wait,clearChildren,initSpeechWarmup}=window.GameUtils,cardsContainer=document.getElementById("cards-container"),house=document.getElementById("house"),houseInfo=house.querySelector(".stack"),checkButton=document.getElementById("check-button"),resetButton=document.getElementById("reset-button"),listenButton=document.getElementById("listen-button"),feedback=document.getElementById("feedback"),progress=document.getElementById("progress");initSpeechWarmup();const emojiMap={\u0434\u0443\u0431:"\u{1F333}",\u0441\u0443\u043F:"\u{1F372}",\u043C\u0430\u043A:"\u{1F33A}",\u0431\u0430\u043A:"\u{1F6E2}\uFE0F",\u0431\u0443\u043A\u0435\u0442:"\u{1F490}",\u043F\u0430\u043A\u0435\u0442:"\u{1F6CD}\uFE0F",\u0431\u043E\u043A:"\u{1F94A}",\u0441\u043E\u043A:"\u{1F9C3}",\u043C\u0443\u043A\u0430:"\u{1F33E}",\u0440\u0443\u043A\u0430:"\u270B"},pairs=[{words:["\u0434\u0443\u0431","\u0441\u0443\u043F"]},{words:["\u043C\u0430\u043A","\u0431\u0430\u043A"]},{words:["\u0431\u0443\u043A\u0435\u0442","\u043F\u0430\u043A\u0435\u0442"]},{words:["\u0431\u043E\u043A","\u0441\u043E\u043A"]},{words:["\u043C\u0443\u043A\u0430","\u0440\u0443\u043A\u0430"]}],rounds=shuffle(pairs.slice());let currentIndex=0,score=0,finished=!1;function createCard(e,n){const t=document.createElement("button");t.type="button",t.className="word-card",t.dataset.word=e,t.dataset.neighbor=n?"true":"false",t.setAttribute("aria-pressed","false");const r=document.createElement("span");r.className="emoji",r.textContent=emojiMap[e]||"\u{1F524}",r.setAttribute("aria-hidden","true"),t.appendChild(r);const o=document.createElement("strong");return o.textContent=e.charAt(0).toUpperCase()+e.slice(1),t.appendChild(o),t.addEventListener("click",()=>handleCardClick(t)),t}function handleCardClick(e){if(finished)return;if(e.parentElement===house)cardsContainer.appendChild(e),e.classList.remove("selected"),e.setAttribute("aria-pressed","false");else{if(house.querySelectorAll(".word-card").length>=2){setFeedback(feedback,"\u0412 \u0434\u043E\u043C\u0438\u043A\u0435 \u0443\u0436\u0435 \u0434\u0432\u0430 \u0441\u043E\u0441\u0435\u0434\u0430. \u041E\u0441\u0432\u043E\u0431\u043E\u0434\u0438\u0442\u0435 \u043C\u0435\u0441\u0442\u043E, \u0447\u0442\u043E\u0431\u044B \u043F\u0435\u0440\u0435\u0441\u0435\u043B\u0438\u0442\u044C \u043D\u043E\u0432\u0443\u044E \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0443.","info");return}house.appendChild(e),e.classList.add("selected"),e.setAttribute("aria-pressed","true")}updateHouseInfo(),speak(e.dataset.word,{rate:1.05,pitch:1.05})}function updateHouseInfo(){const e=house.querySelectorAll(".word-card").length>0;houseInfo.style.display=e?"none":"flex"}function setupRound(){const e=rounds[currentIndex],n=pairs.filter(s=>s!==e).flatMap(s=>s.words),t=shuffle(n).slice(0,2),r=shuffle([{word:e.words[0],isNeighbor:!0},{word:e.words[1],isNeighbor:!0},...t.map(s=>({word:s,isNeighbor:!1}))]);clearChildren(cardsContainer),house.querySelectorAll(".word-card").forEach(s=>cardsContainer.appendChild(s)),updateHouseInfo(),r.forEach(({word:s,isNeighbor:c})=>{const a=createCard(s,c);cardsContainer.appendChild(a)}),updateProgress(progress,currentIndex+1,rounds.length),setFeedback(feedback,"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0432\u0430 \u0441\u043B\u043E\u0432\u0430, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0437\u0432\u0443\u0447\u0430\u0442 \u043F\u043E\u0445\u043E\u0436\u0435.","info"),listenButton.disabled=!1,checkButton.disabled=!1,resetButton.disabled=!1}checkButton.addEventListener("click",async()=>{if(finished)return;const e=Array.from(house.querySelectorAll(".word-card"));if(e.length!==2){setFeedback(feedback,"\u0427\u0442\u043E\u0431\u044B \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C, \u043F\u043E\u0441\u0435\u043B\u0438\u0442\u0435 \u0432 \u0434\u043E\u043C\u0438\u043A\u0435 \u0440\u043E\u0432\u043D\u043E \u0434\u0432\u0430 \u0441\u043B\u043E\u0432\u0430.","error");return}e.every(t=>t.dataset.neighbor==="true")?(score+=1,setFeedback(feedback,"\u0417\u0434\u043E\u0440\u043E\u0432\u043E! \u042D\u0442\u0438 \u0441\u043B\u043E\u0432\u0430 \u2013 \u043D\u0430\u0441\u0442\u043E\u044F\u0449\u0438\u0435 \u0441\u043E\u0441\u0435\u0434\u0438.","success"),currentIndex+=1,await wait(1400),currentIndex>=rounds.length?finishGame():setupRound()):setFeedback(feedback,"\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437: \u0437\u0434\u0435\u0441\u044C \u043F\u043E\u0441\u0435\u043B\u0438\u043B\u0438\u0441\u044C \u043D\u0435 \u0442\u0435 \u0441\u043E\u0441\u0435\u0434\u0438.","error")}),resetButton.addEventListener("click",()=>{finished?restartGame():setupRound()}),listenButton.addEventListener("click",()=>{if(finished)return;const e=Array.from(cardsContainer.querySelectorAll(".word-card")).concat(Array.from(house.querySelectorAll(".word-card"))).map(n=>n.dataset.word);speakSequence(e,{speechOptions:{rate:1.05}})});function finishGame(){finished=!0,updateProgress(progress,rounds.length,rounds.length),setFeedback(feedback,`\u0418\u0433\u0440\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430! \u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0445 \u043F\u043E\u0434\u0431\u043E\u0440\u043E\u0432: ${score} \u0438\u0437 ${rounds.length}. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \xAB\u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430\xBB, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C.`,"success"),listenButton.disabled=!0,checkButton.disabled=!0,resetButton.textContent="\u{1F501} \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430",resetButton.disabled=!1}function restartGame(){finished=!1,currentIndex=0,score=0;const e=shuffle(pairs.slice());rounds.splice(0,rounds.length,...e),resetButton.textContent="\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",setupRound()}setupRound();
