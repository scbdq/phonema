const{speak,wait,shuffle,setFeedback,updateProgress,initSpeechWarmup}=window.GameUtils,targetGreeting=document.getElementById("target-greeting"),currentRow=document.getElementById("current-row"),playButton=document.getElementById("play-rows"),greetButton=document.getElementById("greet-button"),feedback=document.getElementById("feedback"),progress=document.getElementById("progress");initSpeechWarmup();const rounds=shuffle([{greeting:"\u0434\u043E-\u0434\u0443",rows:["\u043D\u043E-\u043D\u0443","\u043F\u043E-\u043F\u0443","\u043A\u043E-\u043A\u044B","\u0442\u043E-\u0442\u0430","\u043C\u043E-\u043C\u0443","\u0432\u043E-\u0432\u0443","\u0431\u043E-\u0431\u0443","\u0431\u043E-\u0431\u0430","\u0434\u043E-\u0434\u0430","\u0434\u043E-\u0434\u0443"]},{greeting:"\u043F\u043E-\u043F\u0443",rows:["\u043A\u043E-\u043A\u0443","\u043C\u043E-\u043C\u0443","\u043F\u043E-\u043F\u0443","\u0434\u043E-\u0434\u0430","\u0432\u043E-\u0432\u0443","\u043F\u043E-\u043F\u0443","\u0431\u043E-\u0431\u0443"]},{greeting:"\u0442\u044B-\u0442\u0438",rows:["\u043C\u044B-\u043C\u0438","\u0432\u044B-\u0432\u0438","\u0442\u044B-\u0442\u0438","\u0434\u044B-\u0434\u0438","\u043F\u044B-\u043F\u0438"]},{greeting:"\u0442\u0443-\u0442\u044E",rows:["\u0442\u0443-\u0442\u044E","\u0431\u0443-\u0431\u044E","\u0432\u0443-\u0432\u044E","\u0442\u0443-\u0442\u044E","\u0434\u0443-\u0434\u044E"]}]);let currentIndex=0,score=0,playing=!1,responded=!1,currentRound;function showRound(){if(currentIndex>=rounds.length){finishGame();return}currentRound=rounds[currentIndex],targetGreeting.textContent=currentRound.greeting,currentRow.textContent="\u2014",updateProgress(progress,currentIndex+1,rounds.length),setFeedback(feedback,"\u041D\u0430\u0436\u043C\u0438\u0442\u0435 \xAB\u041D\u0430\u0447\u0430\u0442\u044C \u043F\u0440\u043E\u0441\u043B\u0443\u0448\u0438\u0432\u0430\u043D\u0438\u0435\xBB \u0438 \u0431\u0443\u0434\u044C\u0442\u0435 \u0433\u043E\u0442\u043E\u0432\u044B \u043F\u043E\u043F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u043E\u0432\u0430\u0442\u044C \u0433\u043E\u0441\u0442\u044F.","info"),greetButton.disabled=!0}async function playSequence(){if(!playing){responded=!1,playing=!0,greetButton.disabled=!1,setFeedback(feedback,"\u0421\u043B\u0443\u0448\u0430\u0439\u0442\u0435 \u0432\u043D\u0438\u043C\u0430\u0442\u0435\u043B\u044C\u043D\u043E!","info");for(const e of currentRound.rows){if(!playing)break;currentRow.textContent=e,await speak(e,{rate:1.05}),await wait(350)}playing=!1,greetButton.disabled=!0,responded||(setFeedback(feedback,"\u041F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u043F\u0440\u043E\u0448\u043B\u043E \u043C\u0438\u043C\u043E. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437!","error"),currentRow.textContent="\u2014")}}async function handleGreet(){if(!playing)return;responded=!0,playing=!1,greetButton.disabled=!0;const e=currentRow.textContent;e===currentRound.greeting?(score+=1,setFeedback(feedback,"\u0423\u0440\u0430! \u0412\u044B \u043F\u043E\u043F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u043E\u0432\u0430\u043B\u0438 \u0433\u043E\u0441\u0442\u044F \u0432\u043E\u0432\u0440\u0435\u043C\u044F.","success"),currentIndex+=1,await wait(1400),showRound()):(setFeedback(feedback,`\u042D\u0442\u043E \u0431\u044B\u043B\u043E \xAB${e}\xBB. \u0416\u0434\u0438\u0442\u0435 \u043F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \xAB${currentRound.greeting}\xBB.`,"error"),await wait(1200),currentRow.textContent="\u2014")}function finishGame(){setFeedback(feedback,`\u041F\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0435\u043D\u043D\u0438\u043A \u0434\u043E\u0432\u043E\u043B\u0435\u043D! \u0423\u0441\u043F\u0435\u0448\u043D\u044B\u0445 \u043F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0439: ${score} \u0438\u0437 ${rounds.length}.`,"success"),updateProgress(progress,rounds.length,rounds.length),playButton.textContent="\u{1F501} \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430"}function restartGame(){currentIndex=0,score=0;const e=shuffle(rounds);rounds.splice(0,rounds.length,...e),playButton.textContent="\u25B6\uFE0F \u041D\u0430\u0447\u0430\u0442\u044C \u043F\u0440\u043E\u0441\u043B\u0443\u0448\u0438\u0432\u0430\u043D\u0438\u0435",showRound()}playButton.addEventListener("click",()=>{currentIndex>=rounds.length?restartGame():playSequence()}),greetButton.addEventListener("click",handleGreet),showRound();
