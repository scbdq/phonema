const{speakSequence,speak,shuffle,setFeedback,updateProgress,wait,clearChildren,initSpeechWarmup}=window.GameUtils,cardsContainer=document.getElementById("cards-container"),slotsContainer=document.getElementById("slots"),playButton=document.getElementById("play-sequence"),clearButton=document.getElementById("clear-selection"),checkButton=document.getElementById("check-sequence"),feedback=document.getElementById("feedback"),progress=document.getElementById("progress");initSpeechWarmup();const sequences=shuffle([["\u043C\u0430\u043A","\u0440\u0430\u043A","\u0431\u0430\u043A"],["\u0434\u043E\u043C","\u043A\u043E\u043C","\u0441\u043E\u043C"],["\u0431\u0443\u0434\u043A\u0430","\u0443\u0442\u043A\u0430","\u0434\u0443\u043B\u043A\u0430"],["\u043C\u043E\u043D\u0435\u0442\u0430","\u043A\u043E\u043D\u0444\u0435\u0442\u0430","\u0440\u0430\u043A\u0435\u0442\u0430"]]);let currentIndex=0,score=0,finished=!1,selectedOrder=[],currentRound=null;function setupRound(){if(currentIndex>=sequences.length){finishGame();return}currentRound=sequences[currentIndex],selectedOrder=[null,null,null],updateProgress(progress,currentIndex+1,sequences.length),setFeedback(feedback,"\u041F\u043E\u0441\u043B\u0443\u0448\u0430\u0439\u0442\u0435 \u0441\u043B\u043E\u0432\u0430 \u0438 \u0440\u0430\u0441\u0441\u0442\u0430\u0432\u044C\u0442\u0435 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0432 \u0443\u0441\u043B\u044B\u0448\u0430\u043D\u043D\u043E\u043C \u043F\u043E\u0440\u044F\u0434\u043A\u0435.","info");const n=shuffle([...new Set(currentRound)]);clearChildren(cardsContainer),clearChildren(slotsContainer),n.forEach(e=>{const t=document.createElement("button");t.type="button",t.className="word-card",t.dataset.word=e;const s=document.createElement("span");s.className="emoji",s.textContent=pickEmoji(e),s.setAttribute("aria-hidden","true"),t.appendChild(s);const c=document.createElement("strong");c.textContent=e.charAt(0).toUpperCase()+e.slice(1),t.appendChild(c),t.addEventListener("click",()=>handleCard(t)),cardsContainer.appendChild(t)});for(let e=0;e<currentRound.length;e+=1){const t=document.createElement("div");t.className="sequence-slot",t.dataset.index=String(e),t.textContent=e+1,t.addEventListener("click",()=>clearSlot(t)),slotsContainer.appendChild(t)}updateCheckState(),speakCurrent()}function pickEmoji(n){return{\u043C\u0430\u043A:"\u{1F33A}",\u0440\u0430\u043A:"\u{1F99E}",\u0431\u0430\u043A:"\u{1F6E2}\uFE0F",\u0434\u043E\u043C:"\u{1F3E0}",\u043A\u043E\u043C:"\u{1FAA8}",\u0441\u043E\u043C:"\u{1F41F}",\u0431\u0443\u0434\u043A\u0430:"\u{1F436}",\u0443\u0442\u043A\u0430:"\u{1F986}",\u0434\u0443\u043B\u043A\u0430:"\u{1F9C1}",\u043C\u043E\u043D\u0435\u0442\u0430:"\u{1FA99}",\u043A\u043E\u043D\u0444\u0435\u0442\u0430:"\u{1F36C}",\u0440\u0430\u043A\u0435\u0442\u0430:"\u{1F680}"}[n]||"\u{1F524}"}function handleCard(n){if(finished)return;const e=n.dataset.word;if(n.classList.contains("selected")){removeWord(e);return}const t=selectedOrder.findIndex(c=>c===null);if(t===-1){setFeedback(feedback,"\u0412\u0441\u0435 \u043F\u043E\u0437\u0438\u0446\u0438\u0438 \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u044B. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u043D\u0430 \u0441\u043B\u043E\u0442, \u0447\u0442\u043E\u0431\u044B \u043E\u0441\u0432\u043E\u0431\u043E\u0434\u0438\u0442\u044C \u0435\u0433\u043E.","info");return}selectedOrder[t]=e,n.classList.add("selected");const s=slotsContainer.querySelector(`.sequence-slot[data-index="${t}"]`);s.textContent=e.charAt(0).toUpperCase()+e.slice(1),s.classList.add("filled"),updateCheckState(),speak(e,{rate:1.05})}function removeWord(n){const e=selectedOrder.findIndex(c=>c===n);if(e===-1)return;selectedOrder[e]=null;const t=slotsContainer.querySelector(`.sequence-slot[data-index="${e}"]`);t.textContent=Number(e)+1,t.classList.remove("filled");const s=cardsContainer.querySelector(`.word-card[data-word="${n}"]`);s&&s.classList.remove("selected"),updateCheckState()}function clearSlot(n){if(!n.classList.contains("filled")||finished)return;const e=Number(n.dataset.index),t=selectedOrder[e];t&&removeWord(t)}function clearSelection(){selectedOrder=[null,null,null],slotsContainer.querySelectorAll(".sequence-slot").forEach((n,e)=>{n.textContent=e+1,n.classList.remove("filled")}),cardsContainer.querySelectorAll(".word-card").forEach(n=>n.classList.remove("selected")),updateCheckState()}function updateCheckState(){const n=selectedOrder.every(e=>e!==null);checkButton.disabled=!n||finished}async function handleCheck(){if(finished||selectedOrder.includes(null))return;selectedOrder.every((e,t)=>e===currentRound[t])?(score+=1,setFeedback(feedback,"\u0417\u0434\u043E\u0440\u043E\u0432\u043E! \u041F\u043E\u0440\u044F\u0434\u043E\u043A \u0441\u043E\u0432\u043F\u0430\u043B.","success"),currentIndex+=1,await wait(1400),clearSelection(),setupRound()):setFeedback(feedback,"\u041F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C \u0434\u0440\u0443\u0433\u0430\u044F. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438.","error")}function speakCurrent(){speakSequence(currentRound,{speechOptions:{rate:1.05}})}function finishGame(){finished=!0,setFeedback(feedback,`\u0412\u044B \u043E\u0442\u043B\u0438\u0447\u043D\u043E \u0441\u043B\u0443\u0448\u0430\u043B\u0438! \u0412\u0435\u0440\u043D\u044B\u0445 \u043F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u0435\u0439: ${score} \u0438\u0437 ${sequences.length}.`,"success"),updateProgress(progress,sequences.length,sequences.length),checkButton.disabled=!0,playButton.textContent="\u{1F501} \u0421\u044B\u0433\u0440\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430"}function restartGame(){finished=!1,currentIndex=0,score=0;const n=shuffle([["\u043C\u0430\u043A","\u0440\u0430\u043A","\u0431\u0430\u043A"],["\u0434\u043E\u043C","\u043A\u043E\u043C","\u0441\u043E\u043C"],["\u0431\u0443\u0434\u043A\u0430","\u0443\u0442\u043A\u0430","\u0434\u0443\u043B\u043A\u0430"],["\u043C\u043E\u043D\u0435\u0442\u0430","\u043A\u043E\u043D\u0444\u0435\u0442\u0430","\u0440\u0430\u043A\u0435\u0442\u0430"]]);sequences.splice(0,sequences.length,...n),playButton.textContent="\u25B6\uFE0F \u041F\u0440\u043E\u0438\u0433\u0440\u0430\u0442\u044C \u043F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C",setupRound()}playButton.addEventListener("click",()=>{finished?restartGame():speakCurrent()}),clearButton.addEventListener("click",()=>clearSelection()),checkButton.addEventListener("click",()=>handleCheck()),setupRound();
